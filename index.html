<!doctype html>
<html lang="en">
<head>
  <link rel="stylesheet" href="./resources/index.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Normal Archive</title>

</head>

<body>

  <div class="nav">
  <a href="#" class="nav-btn">ABOUT</a>
  <a href="#" class="nav-btn">SURVEY</a>
</div>

<div class="logo-wrap">
  <img src="./resources/normallogo.png" class="logo">
</div>

<div class="section-box">
  <h2>NORMAL PEOPLE LOVE:</h2>
  <div id="love-grid"></div>
</div>

<div class="section-box">
  <h2>NORMAL PEOPLE HATE:</h2>
  <div id="hate-grid"></div>
</div>

<script>
const SPREADSHEET_ID = "1Mx799RbxJYIMi4Q2dzfpGHz1PJ4BjSNErYRXIOe0oLQ";
const TAB_NAME = "tab1";

const url =
  `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?sheet=${encodeURIComponent(TAB_NAME)}&tqx=out:json`;

const seenLove = new Set();
const seenHate = new Set();

function loadData(){

fetch(url)
.then(res => res.text())
.then(text => {

  const json = JSON.parse(text.substring(47).slice(0,-2));
  const rows = json.table.rows;

  const loveGrid = document.getElementById("love-grid");
  const hateGrid = document.getElementById("hate-grid");

  rows.forEach(r => {

    const timestamp = r.c[0]?.v ?? "";
    const love = (r.c[1]?.v ?? "").toString().trim();
    const hate = (r.c[2]?.v ?? "").toString().trim();

    /* LOVE */
    if(love){
      const key = timestamp + love;
      if(!seenLove.has(key)){
        seenLove.add(key);

        const row = document.createElement("div");
        row.className = "section-row";
        row.innerHTML = `
          <div class="section-num"></div>
          <div class="section-text">${love}</div>
        `;
        loveGrid.appendChild(row);
      }
    }

    /* HATE */
    if(hate){
      const key = timestamp + hate;
      if(!seenHate.has(key)){
        seenHate.add(key);

        const row = document.createElement("div");
        row.className = "section-row";
        row.innerHTML = `
          <div class="section-num"></div>
          <div class="section-text">${hate}</div>
        `;
        hateGrid.appendChild(row);
      }
    }

  });

  /* Renumber */
  document.querySelectorAll("#love-grid .section-num").forEach((el,i)=>{
    el.textContent = String(i+1).padStart(3,"0");
  });

  document.querySelectorAll("#hate-grid .section-num").forEach((el,i)=>{
    el.textContent = String(i+1).padStart(3,"0");
  });

});
}

loadData();
setInterval(loadData,5000); // 
</script>

</body>
</html>
